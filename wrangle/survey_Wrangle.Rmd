---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library(tidyverse)
library(dplyr)
#library(stringr)


myFiles <- list.files(path = "data/survey/", pattern = "trip*", all.files = FALSE,
           full.names = TRUE, recursive = FALSE,
           ignore.case = FALSE, include.dirs = FALSE, no.. = FALSE)

  trip_in <- read.csv(myFiles[1]) %>% select(c(YEAR,month,AREA,ID_CODE)) %>% filter(AREA=="J")
for (k in 2:length(myFiles)){
    trip_in <- rbind(trip_in,read.csv(myFiles[[k]]) %>% select(c(YEAR,month,AREA,ID_CODE)) %>% filter(AREA=="J"))
}
  

```


```{r}
myFiles <- list.files(path = "data/survey/", pattern = "catch*", all.files = FALSE,
           full.names = TRUE, recursive = FALSE,
           ignore.case = FALSE, include.dirs = FALSE, no.. = FALSE)

catch_in <- read.csv(myFiles[1])

  catch_in <- read.csv(myFiles[1]) %>% select(c(common,MODE_FX,AREA_X,YEAR,month,ID_CODE,tot_cat))
for (k in 2:length(myFiles)){
    catch_in <- rbind(catch_in,read.csv(myFiles[[k]]) %>% select(c(common,MODE_FX,AREA_X,YEAR,month,ID_CODE,tot_cat)))
}


```


```{r}
trip_in <- trip_in %>%
    mutate(ID_CODE=as.character(ID_CODE))

catch_in <- catch_in %>%
    mutate(ID_CODE=as.character(ID_CODE))

head(trip_in)
head(catch_in)

trip_catch <- inner_join(trip_in,catch_in,
          by = c("ID_CODE" = "ID_CODE")) %>%
          group_by(YEAR.x,month.x,common,MODE_FX,AREA_X) %>%
          summarize(catch_count = sum(tot_cat), .groups = 'drop') %>%
          mutate(year=as.integer(YEAR.x),month=as.integer(month.x),catch_count=round(catch_count, digits = 0)) %>%
          filter(catch_count > 0.0)

#view(trip_catch)




```

```{r}
HAB_in <- read_csv("data/hab/Recent_Harmful_Algal_Bloom_(HAB)_Events.csv")

#target <- c("Tom", "Lynn")
#filter(dat, name %in% target)  # equivalently, dat %>% filter(name %in% target)
#new_frame2 <- Mydata%>% filter( between(x, 3, 7) )

HAB <- HAB_in %>%
  filter(str_detect(LOCATION,"Sarasota")) %>%
  mutate(date=as.Date(SAMPLE_DATE)) %>%
  mutate(month=as.integer(format(date, "%m")),year=as.integer(format(date,"%Y"))) %>%
  group_by(year,month) %>%
  summarize(brevis_count = sum(COUNT_),.groups = "drop") %>%
  filter(year=="2020")

#view(HAB)


```

```{r}

HAB_MRIP <- inner_join(trip_catch,HAB,
           by = c("year" = "year","month" = "month")) %>%
           select(c(year,month,common,MODE_FX,AREA_X,catch_count,brevis_count)) %>%
            mutate(year=paste("year",as.character(year),sep = "_")) %>%
            mutate(month=paste("month",as.character(month),sep = "_"))

#view(HAB_MRIP)
fishies <- stringr::str_unique(HAB_MRIP$common)
print(fishies[2])
write.csv(HAB_MRIP,"data/sarasota.csv", row.names = FALSE)

```

